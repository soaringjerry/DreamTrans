# DreamTrans 项目架构与进展报告

**版本**: 1.0
**日期**: 2025-08-03
**作者**: Roo, 项目架构师

## 1. 项目核心定位与设计哲学

`DreamTrans` 是一个具有双重角色的复杂应用，其设计深度整合了 PCAS (个人中央 AI 系统) 的核心理念。

### 1.1. 双重角色

1.  **独立的实时转录 Web 应用**: 它提供了一个功能完整的、用户可以直接使用的 Web 界面，用于高质量、低延迟的实时语音转录。
2.  **PCAS 生态的能力提供方**: 在 PCAS 生态中，`DreamTrans` 扮演着一个关键的“无头”服务角色。它作为一个可插拔的**能力提供方 (Capability Provider)**，向整个生态系统提供核心的“实时语音转录”能力。

### 1.2. 核心设计哲学

项目遵循“**智能端点与哑管道 (Smart Endpoints and Dumb Pipes)**”的设计哲学：

*   **DreamTrans 作为“哑管道/工具”**: 它的核心职责是高效地完成一件事——将输入的音频字节流转换为输出的文本字节流。它不关心业务逻辑，不关心这些数据从哪里来，到哪里去。
*   **PCAS 作为“路由器”**: PCAS 核心系统负责根据策略，将需要“转录”能力的数据流路由到 `DreamTrans`。
*   **其他 D-App (如 DreamScribe) 作为“智能端点”**: 能力的消费方拥有完整的业务上下文，负责调用能力、处理 UI，并将从 `DreamTrans` 获取的非结构化文本流，提炼成有意义的结构化知识，再提交回 PCAS。

这种设计确保了 `DreamTrans` 的**高度可复用性**和整个生态系统的**完全解耦**。

## 2. 架构模式：双重入口与独立部署

为了支撑上述双重角色，`DreamTrans` 被设计为拥有两种完全独立的启动模式和部署产物。

### 2.1. 模式一：标准 Web 应用

这是项目的默认模式，提供一个一体化的、包含前端 UI 的服务。

*   **构成**: Go 后端 (REST API + WebSocket) + React 前端。
*   **启动入口**: `backend/cmd/web/main.go`
*   **Docker 构建**: 使用根目录的 `Dockerfile`，它通过多阶段构建将 Go 后端和编译后的 React 前端打包成一个单一镜像。
*   **端口**: 默认监听 `8080`。

### 2.2. 模式二：PCAS 能力提供方

这是项目的“无头”服务模式，作为一个纯粹的后端 gRPC 服务运行。

*   **构成**: 纯 Go 后端 gRPC 服务。
*   **启动入口**: `backend/cmd/pcas-provider/main.go`
*   **Docker 构建**: 使用 `backend/Dockerfile.pcas`，它只编译和打包 `pcas-provider` 的代码，生成一个轻量级的、不含任何前端代码的镜像。
*   **端口**: 默认监听 `50051` (可通过 `GRPC_PORT` 环境变量修改)。

## 3. PCAS 集成方案：解耦的 gRPC 服务

`DreamTrans` 与 PCAS 的集成遵循现代化的、解耦的微服务架构。

*   **通信方式**: 通过 **gRPC** 进行网络通信，而非在同一进程中通过 Go 接口调用。
*   **服务角色**: `DreamTrans` 作为一个独立的、被动的 gRPC 服务器运行。它不主动连接 PCAS。
*   **服务发现**: PCAS 核心系统通过**服务注册与发现**机制来找到 `DreamTrans`。`DreamTrans` 在启动后，需要向 PCAS 注册自己的 gRPC 地址 (例如 `dreamtrans-pcas:50051`) 和它能提供的能力。
*   **数据流**: 当一个能力消费方请求转录服务时，PCAS 会作为代理，向 `DreamTrans` 的 gRPC 服务发起一个连接，并在两者之间建立一个高效的字节流管道。

## 4. CI/CD 与自动化部署

项目拥有两套并行的、自动化的 CI/CD 工作流，分别对应上述两种部署模式。

1.  **`docker-build.yml`**: 负责构建和发布“标准 Web 应用”模式的镜像，推送到 `ghcr.io/soaringjerry/dreamtrans`。
2.  **`docker-build-pcas.yml`**: 负责构建和发布“PCAS 能力提供方”模式的镜像，推送到 `ghcr.io/soaringjerry/dreamtrans-pcas`。

## 5. 当前状态与结论

`DreamTrans` 项目目前的架构已经非常清晰和成熟。它成功地将一个复杂的应用拆分为两种独立的、可部署的模式，完美地平衡了作为独立产品和作为生态系统组件的双重需求。

项目的代码实现、文档（`DAPP_STREAMING_GUIDE.md`）和自动化部署流程已经与最终的架构设计保持一致。